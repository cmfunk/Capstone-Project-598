

use cmfunk15;


drop table if exists dbo.Account
drop table if exists dbo.Customer
drop table if exists dbo.ATMTransction
drop table if exists dbo.ATM
drop table if exists dbo.CheckingAccount
drop table if exists dbo.SavingsAccount


create table dbo.Account
(
	AccountID int not null identity(1,1) primary key,
	Username nvarchar(32) not null,
	Pass1Textphrase nvarchar(64) not null,
	Balance float,
	Pass2Colorcode nvarchar(64) not null,
	Pass3Image nvarchar(64) not null,
	CreatedOn datetimeoffset not null default (sysdatetimeoffset())
	unique(Username,Pass1Textphrase)
);

create table dbo.Customer
(
	CustomerID int not null identity(1,1) primary key,
	AccountID int not null foreign key references dbo.Account(AccountID),
	Name nvarchar(80) ,--not null,
	Address nvarchar(100) ,--not null,
	DOB datetimeoffset ,--not null,
	CardNumber int ,--not null,
	Pin int ,--not null
	unique(Name, Address, DOB, CardNumber, Pin)
);

--create table ATMTransaction
--(
--	ATMTransactionID int not null identity(1,1) primary key,
--	Date datetimeoffset ,--not null,
--	Type varchar(8) not null check (Type in('Savings ','Checking')),
--	Amount float not null,
--);

create table ATM
(
	ATMID int not null identity(1,1) primary key,
	ATMTransactionID int not null foreign key references dbo.ATMTransaction(ATMTransactionID),
	Location nvarchar(100) --not null
);

create table CheckingAccount
(
	CATransactionID int not null primary key foreign key references dbo.ATMTransaction(ATMTransactionID),
	AccountID int not null foreign key references dbo.Account(AccountID),
	Ammount float not null
);

create table SavingsAccount
(
	SATransactionID int not null primary key foreign key references dbo.ATMTransaction(ATMTransactionID),
	AccountID int not null foreign key references dbo.Account(AccountID),
	Ammount float not null
);






select * from dbo.Account
select * from dbo.Customer
select * from dbo.ATMTransaction
select * from dbo.ATM
select * from dbo.CheckingAccount
select * from dbo.SavingsAccount




insert dbo.Account(Username, Pass1Textphrase, Balance, Pass2Colorcode)
values(N'secondUser', N'fdssaw0rd', 605.23, N'GBYGBRYYP');

insert dbo.Customer(AccountID, Name, Address, DOB, CardNumber, Pin)
values (1, N'test', N'666testing', '20190927 03:34:00 +10:00', 65463456, 7786);





















######stored procedures########
USE [cmfunk15]
GO
/****** Object:  StoredProcedure [dbo].[AddAccount]    Script Date: 12/10/2019 2:34:33 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER procedure [dbo].[AddAccount]
	@UserName nvarchar(32),
	@Pass1Textphrase nvarchar(64),
	@Pass2Colorcode nvarchar(16),
	@Pass3Image nvarchar(64)
as
begin
	--set NOCOUNT on,
	insert dbo.Account (UserName, Pass1TextPhrase, Pass2Colorcode, Pass3Image)
	values (@UserName, @Pass1Textphrase, @Pass2Colorcode, @Pass3Image);
end























